<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Aviator Pro - Real Money</title>
    <script src="/socket.io/socket.io.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background: #0f1923; color: white; font-family: sans-serif; margin: 0; overflow: hidden; display: flex; flex-direction: column; height: 100vh; }
        
        /* HEADER */
        .header { height: 60px; background: #18222d; display: flex; align-items: center; justify-content: space-between; padding: 0 15px; border-bottom: 1px solid #333; }
        .logo { color: #e91e63; font-weight: 900; font-size: 22px; font-style: italic; }
        .wallet { background: #238636; padding: 5px 15px; border-radius: 20px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        
        /* AUTH MODAL */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 5000; display: flex; justify-content: center; align-items: center; }
        .box { background: #18222d; padding: 30px; border-radius: 15px; text-align: center; width: 90%; max-width: 350px; border: 1px solid #333; }
        .inp { width: 100%; padding: 12px; margin: 10px 0; background: #0f1923; border: 1px solid #444; color: white; border-radius: 5px; text-align: center; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; color: white; }
        .btn-g { background: #238636; } .btn-b { background: #2980b9; } .btn-r { background: #e74c3c; }

        /* WALLET MODAL (TABS) */
        .w-tabs { display: flex; border-bottom: 1px solid #444; margin-bottom: 15px; }
        .w-tab { flex: 1; padding: 10px; cursor: pointer; color: #888; font-size: 14px; font-weight: bold; }
        .w-tab.active { color: #e91e63; border-bottom: 2px solid #e91e63; }
        .w-content { display: none; }
        .w-content.active { display: block; }
        
        /* HISTORY LIST */
        .h-list { max-height: 200px; overflow-y: auto; text-align: left; }
        .h-item { font-size: 12px; padding: 8px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; }
        .st-PENDING { color: #f1c40f; } .st-SUCCESS { color: #2ecc71; } .st-REJECTED { color: #e74c3c; }

        /* GAME AREA */
        .game { flex: 1; position: relative; display: flex; flex-direction: column; background: #000; }
        canvas { width: 100%; height: 100%; }
        .hud { position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); text-align: center; pointer-events: none; }
        .mult { font-size: 70px; font-weight: 900; }
        
        .controls { background: #18222d; padding: 15px; display: flex; gap: 10px; justify-content: center; border-top: 1px solid #333; }
        .bet-inp { width: 80px; text-align: center; font-size: 18px; font-weight: bold; background: #0f1923; color: white; border: 1px solid #444; border-radius: 5px; }
        .act-btn { width: 120px; height: 60px; border-radius: 10px; font-size: 20px; font-weight: 900; border: none; cursor: pointer; color: white; }
    </style>
</head>
<body>

    <div id="auth-screen" class="modal">
        <div class="box">
            <h2 class="logo">AVIATOR</h2>
            <div id="login-div">
                <input id="l-u" class="inp" placeholder="Username">
                <input id="l-p" class="inp" type="password" placeholder="Password">
                <button class="btn btn-g" onclick="login()">LOGIN</button>
                <p style="font-size:12px; margin-top:10px; cursor:pointer;" onclick="toggleAuth('reg')">Create Account</p>
            </div>
            <div id="reg-div" style="display:none;">
                <input id="r-u" class="inp" placeholder="New Username">
                <input id="r-p" class="inp" type="password" placeholder="New Password">
                <button class="btn btn-b" onclick="register()">REGISTER</button>
                <p style="font-size:12px; margin-top:10px; cursor:pointer;" onclick="toggleAuth('log')">Back to Login</p>
            </div>
        </div>
    </div>

    <div id="wallet-screen" class="modal" style="display:none;">
        <div class="box">
            <div style="text-align:right; font-size:20px; cursor:pointer;" onclick="toggleWallet(false)">&times;</div>
            
            <div class="w-tabs">
                <div class="w-tab active" onclick="switchTab('dep')">DEPOSIT</div>
                <div class="w-tab" onclick="switchTab('wit')">WITHDRAW</div>
                <div class="w-tab" onclick="switchTab('his')">HISTORY</div>
            </div>

            <div id="tab-dep" class="w-content active">
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=upi://pay?pa=9799548201@ybl&pn=AviatorGame" style="background:white; padding:5px; border-radius:5px;">
                <p style="font-size:12px; margin:10px 0;">UPI: <strong>9799548201@ybl</strong></p>
                <input id="d-amt" type="number" class="inp" placeholder="Amount">
                <input id="d-utr" class="inp" placeholder="UTR Number">
                <button class="btn btn-g" onclick="reqDeposit()">SUBMIT REQUEST</button>
            </div>

            <div id="tab-wit" class="w-content">
                <p style="font-size:12px; color:#aaa;">Withdraw Winnings to Bank/UPI</p>
                <input id="w-amt" type="number" class="inp" placeholder="Amount (Min 100)">
                <input id="w-upi" class="inp" placeholder="Your UPI ID (e.g. name@okicici)">
                <button class="btn btn-r" onclick="reqWithdraw()">REQUEST WITHDRAW</button>
            </div>

            <div id="tab-his" class="w-content">
                <div id="hist-list" class="h-list">Loading...</div>
            </div>
        </div>
    </div>

    <div class="header">
        <div class="logo">AVIATOR</div>
        <div class="wallet" onclick="toggleWallet(true)">
            ₹ <span id="bal">0.00</span> <span>+</span>
        </div>
    </div>

    <div class="game">
        <canvas id="cvs"></canvas>
        <div class="hud">
            <div class="mult" id="mult">1.00x</div>
            <div id="status" style="background:rgba(0,0,0,0.5); padding:5px 10px; border-radius:10px; font-size:12px;">WAITING</div>
        </div>
        <div class="controls">
            <input id="bet-amt" type="number" class="bet-inp" value="10">
            <button id="act-btn" class="act-btn btn-g" onclick="action()">BET</button>
        </div>
    </div>

    <script>
        const socket = io();
        let user=null, bal=0, state="IDLE", mult=1.00, active=false, betVal=0;

        // --- AUTH ---
        function toggleAuth(mode) { 
            document.getElementById('login-div').style.display=mode==='log'?'block':'none'; 
            document.getElementById('reg-div').style.display=mode==='reg'?'block':'none'; 
        }
        function login(){ let u=document.getElementById('l-u').value, p=document.getElementById('l-p').value; if(u&&p) socket.emit('login',{username:u,password:p}); }
        function register(){ let u=document.getElementById('r-u').value, p=document.getElementById('r-p').value; if(u&&p) socket.emit('register',{username:u,password:p}); }
        
        socket.on('login-success', d=>{ user=d.username; bal=d.balance; updateBal(); document.getElementById('auth-screen').style.display='none'; resize(); draw(); });

        // --- WALLET ---
        function toggleWallet(s){ 
            document.getElementById('wallet-screen').style.display=s?'flex':'none'; 
            if(s) socket.emit('get-transactions', user);
        }
        function switchTab(t){
            document.querySelectorAll('.w-tab').forEach(e=>e.classList.remove('active'));
            document.querySelectorAll('.w-content').forEach(e=>e.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('tab-'+t).classList.add('active');
        }
        function reqDeposit(){
            let a=document.getElementById('d-amt').value, u=document.getElementById('d-utr').value;
            if(a&&u){ socket.emit('deposit-request',{username:user,amount:a,utr:u}); alert("Deposit Pending!"); toggleWallet(false); }
        }
        function reqWithdraw(){
            let a=document.getElementById('w-amt').value, u=document.getElementById('w-upi').value;
            if(a&&u){ socket.emit('withdraw-request',{username:user,amount:a,upi:u}); toggleWallet(false); }
        }
        socket.on('withdraw-success', m=>alert(m));
        socket.on('withdraw-error', m=>alert(m));
        
        socket.on('transaction-history', list=>{
            let h=document.getElementById('hist-list'); h.innerHTML="";
            list.forEach(t=>{
                let c=t.status==='SUCCESS'?'st-SUCCESS':t.status==='REJECTED'?'st-REJECTED':'st-PENDING';
                h.innerHTML+=`<div class="h-item">
                    <span>${t.type} ₹${t.amount}</span>
                    <span class="${c}">${t.status}</span>
                </div>`;
            });
        });

        // --- GAME ---
        function updateBal(){ document.getElementById('bal').innerText=bal.toFixed(2); }
        socket.on('balance-update', b=>{ bal=b; updateBal(); });
        socket.on('force-balance-update', d=>{ if(d.username===user){ bal=d.balance; updateBal(); alert("Wallet Balance Updated!"); }});

        socket.on('tick', m=>{ mult=m; document.getElementById('mult').innerText=m.toFixed(2)+"x"; draw(); if(active) updateBtn(`CASH OUT\n₹${(betVal*mult).toFixed(0)}`, 'btn-b'); });
        socket.on('state-change', d=>{ state=d.state; if(state==='IDLE'){ resetUI(); document.getElementById('status').innerText="NEXT: "+d.countdown+"s"; } else { document.getElementById('status').style.display='none'; if(active) updateBtn("CASH OUT", 'btn-b'); else disableBtn(); } });
        socket.on('crash', d=>{ document.getElementById('mult').style.color='#e74c3c'; document.getElementById('status').innerText=`FLEW @ ${d.multiplier}x`; document.getElementById('status').style.display='block'; if(active){ active=false; updateBtn("LOST", 'btn-r'); } setTimeout(()=>{if(!active) resetUI();}, 2000); });

        function action(){
            if(state==='IDLE' && !active){
                let v=parseInt(document.getElementById('bet-amt').value);
                if(v<=bal){ active=true; betVal=v; socket.emit('place-bet',{username:user,amount:v}); updateBtn("WAITING", 'btn-r'); } else alert("Low Balance");
            } else if(state==='FLYING' && active){
                active=false; socket.emit('cash-out',{username:user,winAmount:betVal*mult}); updateBtn("WON", 'btn-g');
            }
        }

        function resetUI(){ document.getElementById('mult').style.color='white'; document.getElementById('mult').innerText="1.00x"; if(!active) updateBtn("BET", 'btn-g'); document.getElementById('act-btn').disabled=false; document.getElementById('act-btn').style.opacity=1; }
        function updateBtn(t,c){ let b=document.getElementById('act-btn'); b.innerText=t; b.className=`act-btn ${c}`; }
        function disableBtn(){ let b=document.getElementById('act-btn'); b.disabled=true; b.style.opacity=0.5; }

        // --- CANVAS ---
        const cvs=document.getElementById('cvs'), ctx=cvs.getContext('2d');
        function resize(){ cvs.width=cvs.parentElement.clientWidth; cvs.height=cvs.parentElement.clientHeight; }
        function draw(){ ctx.clearRect(0,0,cvs.width,cvs.height); if(state==='CRASHED')return; let p=(mult-1)/3.5; if(p>1)p=1; let x=50+p*(cvs.width-100), y=cvs.height-50-p*(cvs.height-100); ctx.beginPath(); ctx.moveTo(0,cvs.height); ctx.quadraticCurveTo(x/2,cvs.height,x,y); ctx.strokeStyle='#e91e63'; ctx.lineWidth=3; ctx.stroke(); ctx.fillStyle='rgba(233,30,99,0.3)'; ctx.fill(); ctx.beginPath(); ctx.arc(x,y,5,0,7); ctx.fillStyle='white'; ctx.fill(); }
        window.onresize=resize;
    </script>
</body>
</html>
